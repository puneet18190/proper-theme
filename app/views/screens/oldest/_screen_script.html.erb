<script type="text/javascript">
$(document).ready(function() {
	var ids = []
	<% @properties.each do |n|%>
		ids.push(<%=n.id%>)
	<%end%>	
	var index=0
	run_script(ids,ids[0],index);
})	

function run_script(ids,property_id,index){
	if(index != ids.length){
		randomColor = Math.floor(Math.random()*16777215).toString(16);
		$.ajax({
			type : 'get',
			url : 'screens/oldest_properties_detail/'+property_id,
			data : 'page=<%=page%>',
			async: false,
			success : function(response){
				$(".main_container").toggle( "fast")
				$(".main_container").html(response);
				$(".main_container").toggle( "fast")
				$("body").css("background-color","#"+randomColor)
				init_slider();
				var num = index + 1
				var delay = 50000;
				$(".screen_num").html("<%=page%> :Page "+num)
				$.localStorage.set('p'+index,response);
				index = index+1;
				console.log(index)
				if (index == ids.length){
					run_script(ids,ids[index],index);
				}else{
					setTimeout(
					  function() 
					  {
					    run_script(ids,ids[index],index);
					  }, delay);
				}
			},
			error : function(){
				var ids = []
				<% @properties.each do |n|%>
					ids.push(<%=n.id%>)
				<%end%>	
				var index=0
				run_script(ids,ids[0],index);
				init_slider();
			}
		})
	}else{
		run_script_by_cookie(0,ids)
		init_slider();

	}	
}

function run_script_by_cookie(index,ids){
	var delay = 50000;
	if($.localStorage.isSet('p'+index)){
		setTimeout(
		  function() 
		  {
		  	randomColor = Math.floor(Math.random()*16777215).toString(16);
		  	$(".main_container").html($.localStorage.get('p'+index));
		  	init_slider();
			index = index + 1;
			$(".main_container").toggle( "fast")
			$(".screen_num").html("<%=page%>:Page "+(index))
			$("body").css("background-color","#"+randomColor)
			$(".main_container").toggle( "fast")
			if (index == ids.length){
				index = 0;
			}
			run_script_by_cookie(index,ids);
		  }, delay);
	}
}
</script>