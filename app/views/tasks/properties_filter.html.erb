<div id="content">
  <div id="main-title-content" class="no-padding">
    <img src="assets/properties/slider/fslider/p1.jpg" id="bg" alt="main-title"/>
    <div class="container">
      <div class="panel">
        <h1>Properties</h1>
        <p>Currently Available</p>
      </div>
    </div>
  </div>
  <div class="news-carousel-wrapper">
    <dl id="news-carousel" class="news-carousel-style">
      <%= render 'properties/news_carousel'%>
    </dl>
  </div>
  <div class="container" style="width:1030px">
    <div class="row-fluid">
      <div class="span9">
        <div class="panel right-line">
          <div class="row-fluid">
            <div class="span6">
              <h2 class="main-heading bottom-line"><span class="main-circle-icon"><i class="icon-building"></i></span> Properties List</h2>   
            </div>
            <div class="span6 ">
              <div class="main-heading bottom-line line-before filterarea">
                <form class="filterform">
                  <p></p>
                    <select class="sort">
                        <option class="asc active" id="asc">Asc</option>
                        <option class="desc" id="desc">Desc</option>
                    </select>
                    <select class="condition">
                        <option class="price active" id="price">Price</option>
                        <option class="name" id="name">Name</option>
                    </select>
                </form>
              </div>
            </div>
          </div>
          <div class="filter_data">
          <% if @data.empty? %>
            <div class="item" >
              <a href="#" class="with-hover">
                <img alt='images' src="assets/default_images/no.jpg" class="full"/><span class="mask_hover"></span>
              </a>
            </div>
          <% else %>
            <% @data.each do |task| %>
              <% if task.visibility== true %>
                <div class="list-properties right-space">
                  <div class="property ">
                    <div class="row-fluid">
                      <div class="span6">
                        <div class="property-images">
                          <a href=<%= "/properties_detail/"+task.slug%>>
                            <div class="mask">
                              <div class="desc-type for-sale"><%=property_status(task.category, task.status) %></div>
                              <div class="price">&pound; <%= task.price.to_i.to_s.reverse.gsub(/(\d{3})(?=\d)/, '\\1,').reverse %></div>
                            </div>
                            <%= image_tag responsive_image(task.image1), :style=>"height:250px;width:500px;" %>
                          </a>
                        </div>
                      </div>
                      <div class="span6">
                        <div class="property-details">
                          <h3><a href=<%= "/properties_detail/"+task.slug%> ><%=task.name%></a></h3>
                          <p><%= task.short_description %></p>
                          <p>
                            <span class="label"><i class="icon-circle-arrow-right"></i> Beds : <%= task.beds %></span>
                            <span class="label"><i class="icon-circle-arrow-right"></i> Bath : <%= task.bath %></span>
                            <span class="label"><i class="icon-circle-arrow-right"></i> Garden : <%= task.garden %></span>
                            <% unless task.parking_status == "none" %>
                              <span class="label" style="margin-top:5px"><i class="icon-circle-arrow-right"></i> Parking : <%= task.parking_status %></span>
                            <%end%>
                            <% if task.gas_ch == "Yes" %>
                              <span class="label" style="margin-top:5px"><i class="icon-circle-arrow-right"></i> Gas CH : <%= task.gas_ch %></span>
                            <%end%>
                            <% if task.dg == "Yes" %>
                              <span class="label" style="margin-top:5px"><i class="icon-circle-arrow-right"></i> DG : <%= task.dg %></span>
                            <%end%>  
                          </p>
                          <div class="agent-preview">
                            <div class="agent-image pull-left"  ><a href="#"><%= image_tag task.agent.nil? ? "noimage.gif" :responsive_image(task.agent.image), :style=>"height:80px;width:200px;" %></a></div>
                            <div class="agent-contant pull-right">
                              <ul class="unstyled">
                                <%if task.agent.nil? %>
                                  <li style="font-size:15px"><b><%= task.user.first_name %></b></li>
                                  <li style="font-size:15px"><b>Private Landlord</b></li>
                                <%else%>
                                  <li><i class="icon-phone"></i><%=task.agent.phone%></li>
                                  <li><i class="icon-envelope"></i><%=task.agent.email_id%></li>
                                  <li><i class="icon-facebook"></i><%=task.agent.fb_id%></li>
                                  <li><i class="icon-twitter"></i><%=task.agent.twitter_id%></li>
                                <%end%>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            <% end %>
          <% end %>
        </div>
        </div>
      </div>
      <div class="span3">
        <div class="panel">
          <%= render 'shared/property_search'%>
          <h3 class="bottom-line  line-before main-heading">
            <span class="main-circle-icon"><i class="icon-list"></i></span>  Our Agents
          </h3>
          <div class="list-items ">
            <% @agents.each do |agent| %>
              <div class="item">
                <%=  image_tag responsive_image(agent.image), alt: "Corin Langpost", class: "img-preview" %>
                  <div class="item-desk">
                    <div class="title">
                      <h3><a href="#"><%=agent.name%></a></h3>
                    </div>
                    <div class="location"><%=agent.address%></div>
                    <a href="#" class="btn-proper btn-mini btn">Profile Page</a>
                  </div>
                <div class="clearfix"></div>
              </div>
            <% end %>
          </div>
        </div>
        <h3 class="bottom-line line-before main-heading top-line">
          <span><%= image_tag "sealmark.png", style: "width:55px;height:60px" %></span><a href="/seal_approved" id="seal_approve">  SEAL Approved</a>
        </h3>
        <div class="list-items">
          <p>
          Properties which are marked with the Seal of Approval are marketed by SEAL Properties on behalf of the Landlord or Vendor who have commissioned our traditional estate agency services under our Pro or Pro Plus+ plans.</p>
          <p> 
          Properties not displaying the seal are marketed by the Landlord or Vendor themselves under our Basic and Basic Plus+ plans which allow Landlords and Vendors the opportunity to self-promote their properties using our marketing infrastructure.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $(document).ready(function() {
    $(".condition, .sort").click(function(){
      target = document.getElementById('loading')
      spinner = new Spinner({radius: 80,width:25,length:60}).spin(target)
      var src = $( "."+$(this).attr("class")+" option:selected" )
      if(src.attr("id") == "asc" || src.attr("id") == "desc"){
        condition = $(".condition .active").attr("id")
        sort = src.attr("id")
      }else{
        sort = $(".sort .active").attr("id")
        condition = src.attr("id")
      }
      src.parent().find("option").removeClass("active")
      src.addClass("active");
      $.ajax({
        type: "get",
        url: "/properties_filter",
        data: "condition="+condition+"&sort="+sort,
        success: function(res){
          $(".filter_data").html($(res).find(".filter_data").html())
          target.removeChild(spinner.el)
        },
        error: function(){
          target.removeChild(spinner.el)
        }
      })
    })
  })  
</script>